/* Generated by re2c 1.1.1 on Fri Jul 19 07:27:50 2019 */
#line 1 "src/cmds.re.c"
#include "cmds.h"
#include <stdio.h>
#include <prpc/lex.h>
#include <prpc/msg.h>
#include <sys/log.h>

PRPC_Parse_Function_t prpc_cmd_parser_get( const char **ptr, const char *end );
PRPC_CMD( has )
{
    const char *name_begin, *name_end;
    PRPC_Status_t stat = prpc_cmd_parse_args( ptr, id, 1, TOKEN_IDENTIFIER, &name_begin, &name_end );
    if( stat.status == PRPC_OK ) {
        log_verbose(">> Looking for %.*s", name_end-name_begin, name_begin);
        PRPC_Parse_Function_t cmd = prpc_cmd_parser_get(&name_begin, name_end);
        prpc_build_result_boolean( resp_buf, max_resp_len, id, cmd != NULL );
    }
    else prpc_build_error_status( resp_buf, max_resp_len, id, stat );
}

PRPC_CMD( hello )
{
    printf("Hello world !\n");
    prpc_build_ok( resp_buf, max_resp_len, id );
}

PRPC_CMD( funky )
{
    prpc_build_result( resp_buf, max_resp_len, id, 4, PRPC_INT, 1203, PRPC_BOOLEAN, 1, PRPC_STRING, "ARGH", PRPC_IDENTIFIER, "OOOH" );
}

PRPC_CMD( replicate )
{
    int        intg;
    float       num;
    uint8_t boolean;

    PRPC_Status_t stat = prpc_cmd_parse_args( ptr, id, 3,
        PRPC_INT, &intg,
        PRPC_FLOAT, &num,
        PRPC_BOOLEAN, &boolean
    );

    if( stat.status == PRPC_OK ) {
        prpc_build_result( resp_buf, max_resp_len, id, 3, PRPC_INT, intg, PRPC_FLOAT, num, PRPC_BOOLEAN, boolean );
    }

    else prpc_build_error_status( resp_buf, max_resp_len, id, stat );
}

PRPC_Parse_Function_t prpc_cmd_parser_get( const char **ptr, const char *end )
{
    const char *YYMARKER;

    
#line 58 "src/cmds.c"
{
	char yych;
	yych = *(*ptr);
	switch (yych) {
	case 'F':
	case 'f':	goto yy4;
	case 'H':
	case 'h':	goto yy5;
	case 'R':
	case 'r':	goto yy6;
	default:	goto yy2;
	}
yy2:
	++(*ptr);
yy3:
#line 62 "src/cmds.re.c"
	{ return NULL;               }
#line 76 "src/cmds.c"
yy4:
	yych = *(YYMARKER = ++(*ptr));
	switch (yych) {
	case 'U':
	case 'u':	goto yy7;
	default:	goto yy3;
	}
yy5:
	yych = *(YYMARKER = ++(*ptr));
	switch (yych) {
	case 'A':
	case 'a':	goto yy9;
	case 'E':
	case 'e':	goto yy10;
	default:	goto yy3;
	}
yy6:
	yych = *(YYMARKER = ++(*ptr));
	switch (yych) {
	case 'E':
	case 'e':	goto yy11;
	default:	goto yy3;
	}
yy7:
	yych = *++(*ptr);
	switch (yych) {
	case 'N':
	case 'n':	goto yy12;
	default:	goto yy8;
	}
yy8:
	(*ptr) = YYMARKER;
	goto yy3;
yy9:
	yych = *++(*ptr);
	switch (yych) {
	case 'S':
	case 's':	goto yy13;
	default:	goto yy8;
	}
yy10:
	yych = *++(*ptr);
	switch (yych) {
	case 'L':
	case 'l':	goto yy14;
	default:	goto yy8;
	}
yy11:
	yych = *++(*ptr);
	switch (yych) {
	case 'P':
	case 'p':	goto yy15;
	default:	goto yy8;
	}
yy12:
	yych = *++(*ptr);
	switch (yych) {
	case 'K':
	case 'k':	goto yy16;
	default:	goto yy8;
	}
yy13:
	yych = *++(*ptr);
	switch (yych) {
	case 0x00:
	case '\t':
	case '\n':
	case '\r':
	case ' ':	goto yy17;
	default:	goto yy8;
	}
yy14:
	yych = *++(*ptr);
	switch (yych) {
	case 'L':
	case 'l':	goto yy19;
	default:	goto yy8;
	}
yy15:
	yych = *++(*ptr);
	switch (yych) {
	case 'L':
	case 'l':	goto yy20;
	default:	goto yy8;
	}
yy16:
	yych = *++(*ptr);
	switch (yych) {
	case 'Y':
	case 'y':	goto yy21;
	default:	goto yy8;
	}
yy17:
	++(*ptr);
#line 63 "src/cmds.re.c"
	{ return prpc_cmd_has;       }
#line 173 "src/cmds.c"
yy19:
	yych = *++(*ptr);
	switch (yych) {
	case 'O':
	case 'o':	goto yy22;
	default:	goto yy8;
	}
yy20:
	yych = *++(*ptr);
	switch (yych) {
	case 'I':
	case 'i':	goto yy23;
	default:	goto yy8;
	}
yy21:
	yych = *++(*ptr);
	switch (yych) {
	case 0x00:
	case '\t':
	case '\n':
	case '\r':
	case ' ':	goto yy24;
	default:	goto yy8;
	}
yy22:
	yych = *++(*ptr);
	switch (yych) {
	case 0x00:
	case '\t':
	case '\n':
	case '\r':
	case ' ':	goto yy26;
	default:	goto yy8;
	}
yy23:
	yych = *++(*ptr);
	switch (yych) {
	case 'C':
	case 'c':	goto yy28;
	default:	goto yy8;
	}
yy24:
	++(*ptr);
#line 65 "src/cmds.re.c"
	{ return prpc_cmd_funky;     }
#line 219 "src/cmds.c"
yy26:
	++(*ptr);
#line 64 "src/cmds.re.c"
	{ return prpc_cmd_hello;     }
#line 224 "src/cmds.c"
yy28:
	yych = *++(*ptr);
	switch (yych) {
	case 'A':
	case 'a':	goto yy29;
	default:	goto yy8;
	}
yy29:
	yych = *++(*ptr);
	switch (yych) {
	case 'T':
	case 't':	goto yy30;
	default:	goto yy8;
	}
yy30:
	yych = *++(*ptr);
	switch (yych) {
	case 'E':
	case 'e':	goto yy31;
	default:	goto yy8;
	}
yy31:
	yych = *++(*ptr);
	switch (yych) {
	case 0x00:
	case '\t':
	case '\n':
	case '\r':
	case ' ':	goto yy32;
	default:	goto yy8;
	}
yy32:
	++(*ptr);
#line 66 "src/cmds.re.c"
	{ return prpc_cmd_replicate; }
#line 260 "src/cmds.c"
}
#line 67 "src/cmds.re.c"

}

void process_cmd( char *resp, const size_t max_len, const PRPC_ID_t id, const char *name_start, const char *name_end, const char **ptr )
{
    PRPC_Parse_Function_t cmd = prpc_cmd_parser_get(&name_start, name_end);
    if( cmd != NULL ) {
        cmd( ptr, resp, max_len, id );
    }

    else {
        prpc_build_error( resp, max_len, id, "Uknown method" );
    }
}

void cmds_init()
{
    prpc_process_callback_register( process_cmd, NULL );
}
